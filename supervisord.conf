[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:comfyui]
command=python3 /app/comfyui/main.py --listen 0.0.0.0 --port 8188 --disable-auto-launch
directory=/app/comfyui
autostart=true
autorestart=true
startretries=3
stdout_logfile=/var/log/comfyui/stdout.log
stderr_logfile=/var/log/comfyui/stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
environment=PYTHONUNBUFFERED="1"

[program:diffbox]
command=/usr/local/bin/diffbox
directory=/app/diffbox
autostart=true
autorestart=true
startretries=3
startsecs=10
stdout_logfile=/var/log/diffbox/stdout.log
stderr_logfile=/var/log/diffbox/stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
environment=
    DIFFBOX_PORT="8080",
    DIFFBOX_DATA_DIR="/data",
    DIFFBOX_MODELS_DIR="/models",
    DIFFBOX_OUTPUTS_DIR="/outputs",
    DIFFBOX_STATIC_DIR="/app/diffbox/static",
    COMFYUI_URL="http://localhost:8188",
    PYTHONUNBUFFERED="1"

# Wait for ComfyUI to be ready before starting diffbox
depends_on=comfyui
